<?php session_start();  include_once 'dbconnect.php';?>
<?php
    $result = $conn->query("SELECT * FROM Products where productId = 20");
    $prod = $result -> fetch_assoc();
    $hits = $prod["productHits"] + 1;
    $conn->query("UPDATE Products SET productHits = ".$hits." WHERE productId = 20");    
    //$conn->close();
?>
<?php 
   if(isset($_SESSION["isSecure"]))
   {
       if($_SESSION["isSecure"])
       {
           $currentUserName = $_SESSION["user"];
           $result = $conn->query("SELECT * FROM UsersList where userName = '".$currentUserName."'");
           $customer = $result -> fetch_assoc();
           $custvisited = $customer["visited"];
           if(isset($custvisited) && $custvisited!="")
           {
               //$custvisitedarr = explode(",",$custvisited);
               //if(!in_array("A1",$custvisitedarr))
               $custvisited = $custvisited.",B20";
           }
           else
           {
               $custvisited = $custvisited."B20";
           }
           $conn->query("UPDATE UsersList SET visited = '".$custvisited."' WHERE userName = '".$currentUserName."'");    
           //$conn->close();
       }
   }
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <?php include 'head.php' ?>
    <title>Singapore | GTS Tours</title>
</head>
<body class="singaporePage">
    <?php $page='Singapore'; include 'navbar.php' ?>
    <div class="topContainer">
        <!-- Carousel -->
        <div id="myCarousel" class="carousel slide" data-bs-ride="carousel">
            <!-- Indicators/dots -->
            <div class="carousel-indicators">
            <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2"></button>
            </div>

            <!-- The slideshow/carousel -->
            <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="../img/2_Singapore.jpeg" alt="2_Singapore" class="d-block" style="width:100%">
            </div>
            <div class="carousel-item">
                <img src="../img/1_Singapore.jpeg" alt="1_singapore" class="d-block" style="width:100%">
            </div>
            <div class="carousel-item">
                <img src="../img/3_Singapore.jpeg" alt="3_singapore" class="d-block" style="width:100%">
            </div>
            </div>

            <!-- Left and right controls/icons -->
            <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
            </button>
        </div>

        <div class="longDescContainer">
            <h4 class="Desctext">Short History</h4>
            <p class="longDesc">
            Singapore, a dynamic city-state at the crossroads of Asia, is a modern marvel where cutting-edge architecture, lush green spaces, and a multicultural tapestry come together seamlessly. The iconic skyline, adorned with architectural gems like the Marina Bay Sands and the futuristic Supertrees of Gardens by the Bay, reflects the city's commitment to innovation and urban sustainability. Singapore's commitment to creating a "City in a Garden" is evident in its meticulously maintained parks and the UNESCO-listed Singapore Botanic Gardens, providing a serene escape amidst the urban hustle.
            <br>
            <br>
            This melting pot of cultures embraces diversity, evident in neighborhoods like Chinatown, Little India, and Kampong Glam, where historic temples, vibrant markets, and mosques coexist harmoniously. The city's culinary scene mirrors its multicultural essence, with hawker centers offering a mouthwatering array of local dishes, from Hainanese chicken rice to laksa. Singapore is a shopper's paradise, with Orchard Road boasting luxury boutiques and diverse shopping malls, while cultural precincts like Bras Basah-Bugis showcase a vibrant arts scene. Beyond the urban expanse, Sentosa Island offers a resort-like escape, complete with theme parks, pristine beaches, and world-class entertainment. Singapore's efficient public transport, impeccable cleanliness, and dedication to green initiatives make it a destination that seamlessly blends modernity with cultural richness, offering a unique and unforgettable experience for visitors.
            </p>
        </div>
    </div>

    <div class="bottomContainer">
        <div class="containerHeader">
            <h3 class="reviewsText">Reviews</h4>
            <?php 
                $sql = "SELECT * FROM Products WHERE productID = 20";
                $result = mysqli_query($conn, $sql);
                $rows = mysqli_num_rows($result);
                if($rows > 0)
                {
                    while($row = $result->fetch_assoc())
                    {
                        echo "<div class='reviewContainer'>\n";
                            echo"<h4 style='margin-right:1em'>Average Rating</h4>";
                            for($i = 1; $i<=5; $i++)
                            {
                                $roundedRating = ceil($row["productAvgRating"]);
                                echo "<i class='fa fa-star ";
                                if($i <= $roundedRating)
                                {
                                    echo "checked";
                                }
                                else
                                {
                                    echo "unchecked";
                                }
                                echo"'></i>\n";
                            }
                    echo "</div>\n";
                    }
                }
            ?>
        </div>
        <?php 
            $sql = "SELECT * FROM Ratings WHERE productID = 20";
            $result = mysqli_query($conn, $sql);
            $rows = mysqli_num_rows($result);
            if($rows > 0)
            {
                while($row = $result->fetch_assoc())
                {
                    echo "<div class='topReviewContainer'>\n";
                        echo "<div class='ratingContainer'>\n";
                            echo "<h4 class='currentUser'>".$row['userName']."</h4>";

                            for($i=1; $i<=5; $i++)
                            {
                                echo "<i class='fa fa-star ";
                                
                                if($i <= $row['rating'])
                                {
                                    echo "checked";
                                }
                                else
                                {
                                    echo "unchecked";
                                }
                                echo"'></i>\n";
                            }
                        echo "</div>\n";

                        echo "<div class='reviewContainer'>\n";
                            echo "<p class='reviewText'>".$row['review']."</p>";
                        echo "</div>\n";
                    echo "</div>\n";
                }
            }
        ?>
    </div>
</body>